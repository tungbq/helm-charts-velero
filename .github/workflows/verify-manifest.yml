name: Install kubectl

on:
  push:
    branches:
      - ci-verify-manifest

jobs:
  install-kubectl:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Checkout repository
        run: |
          ls -la
          git status

      - name: Install kubectl
        run: |
          # Install kubectl
          KUBECTL_VERSION="v1.21.0" # Replace with the desired version
          curl -LO "https://dl.k8s.io/release/${KUBECTL_VERSION}/bin/linux/amd64/kubectl"
          chmod +x kubectl
          sudo mv kubectl /usr/local/bin/
          kubectl version --client
      # - uses: azure/setup-kubectl@v3
      #   with:
      #     version: '<version>' # default is latest stable
      #   id: install
      - name: Create kind cluster
        uses: helm/kind-action@v1.2.0
        with:
          version: "v0.14.0"
          node_image: "kindest/node:v1.19.16"

      - name: Run trial commands
        run: |
          cd charts/velero
          ls -la
          kubectl version
          kubectl apply --dry-run=none -f crds/ -o yaml > v1_debug_origin_kubectl.yaml
          cat v1_debug_origin_kubectl.yaml
